<?xml version="1.0" encoding="UTF-8"?><sqlb_project><db path="DB.db" readonly="0" foreign_keys="1" case_sensitive_like="0" temp_store="0" wal_autocheckpoint="1000" synchronous="2"/><attached/><window><main_tabs open="structure browser pragmas query" current="3"/></window><tab_structure><column_width id="0" width="300"/><column_width id="1" width="0"/><column_width id="2" width="100"/><column_width id="3" width="2870"/><column_width id="4" width="0"/><expanded_item id="0" parent="1"/><expanded_item id="1" parent="1"/><expanded_item id="2" parent="1"/><expanded_item id="3" parent="1"/></tab_structure><tab_browse><table title="v_tierKrankheiten" custom_title="0" dock_id="1" table="4,17:mainv_tierKrankheiten"/><dock_state state="000000ff00000000fd00000001000000020000041700000258fc0100000001fb000000160064006f0063006b00420072006f00770073006500310100000000000004170000012600ffffff000002710000000000000004000000040000000800000008fc00000000"/><default_encoding codec=""/><browse_table_settings><table schema="main" name="behandlung" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_" freeze_columns="0"><sort/><column_widths><column index="1" value="84"/><column index="2" value="93"/><column index="3" value="73"/><column index="4" value="90"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="futter" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_" freeze_columns="0"><sort><column index="2" mode="0"/></sort><column_widths><column index="1" value="56"/><column index="2" value="63"/><column index="3" value="127"/><column index="4" value="86"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="futterlager" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_" freeze_columns="0"><sort/><column_widths><column index="1" value="80"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="futtertrog" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_" freeze_columns="0"><sort/><column_widths><column index="1" value="75"/><column index="2" value="101"/><column index="3" value="51"/><column index="4" value="60"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="krankheit" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_" freeze_columns="0"><sort/><column_widths><column index="1" value="76"/><column index="2" value="223"/><column index="3" value="75"/><column index="4" value="300"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="log" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_" freeze_columns="0"><sort/><column_widths><column index="1" value="37"/><column index="2" value="260"/><column index="3" value="463"/><column index="4" value="234"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="tier" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_" freeze_columns="0"><sort/><column_widths><column index="1" value="41"/><column index="2" value="63"/><column index="3" value="87"/><column index="4" value="215"/><column index="5" value="69"/><column index="6" value="38"/><column index="7" value="87"/><column index="8" value="127"/><column index="9" value="69"/><column index="10" value="63"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="v_Lagerbestand" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_" freeze_columns="0"><sort/><column_widths><column index="1" value="127"/><column index="2" value="129"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="v_besonderePflege" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_" freeze_columns="0"><sort/><column_widths><column index="1" value="41"/><column index="2" value="63"/><column index="3" value="183"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="v_schwangerschaft" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_" freeze_columns="0"><sort/><column_widths><column index="1" value="41"/><column index="2" value="60"/><column index="3" value="69"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="v_tierInfo" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_" freeze_columns="0"><sort/><column_widths><column index="1" value="41"/><column index="2" value="63"/><column index="3" value="58"/><column index="4" value="71"/><column index="5" value="69"/><column index="6" value="35"/><column index="7" value="87"/><column index="8" value="57"/><column index="9" value="71"/><column index="10" value="50"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="v_tierKrankheiten" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_" freeze_columns="0"><sort><column index="4" mode="0"/></sort><column_widths><column index="1" value="41"/><column index="2" value="60"/><column index="3" value="300"/><column index="4" value="143"/><column index="5" value="404"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table></browse_table_settings></tab_browse><tab_sql><sql name="SQL 1*">CREATE VIEW v_lagerbestand AS
SELECT
    f.name AS futtersorte,
    f.mengeKg AS verfuegbarer_bestand
FROM futter f;

CREATE VIEW v_fuetterung AS
SELECT
    g.name AS gehege,
    f.name AS futtersorte,
    ft.futtermengeKg,
    g.fuetterungszeit
FROM gehege g
JOIN futtertrog ft ON ft.gehegeId = g.gehegeId
JOIN futter f ON f.futterId = ft.futterId;

CREATE VIEW v_tierKrankheiten AS
SELECT
    t.tierId,
    t.name AS tiername,
    k.name AS krankheit,
    k.ansteckend,
    k.behandlungsmassnahme
FROM tier t
JOIN infizierung i ON i.tierId = t.tierId
JOIN krankheit k ON k.krankheitId = i.krankheitId;

drop view v_schwangerschaft;
CREATE VIEW v_schwangerschaft AS
SELECT
    t.tierId,
    t.name AS tiername
FROM tier t
WHERE t.schwanger = 1;  -- Hier den Vergleich mit der Zahl 1 statt mit dem String '1' durchführen


CREATE VIEW v_tierInfo AS
SELECT
    t.tierId,
    t.name AS tiername,
    t.tiersorte,
    t.tierart,
    t.geschlecht,
    t.jahre AS alter,
    t.geburtstag,
    t.herkunft,
    f.name AS futtersorte,
    g.name AS gehege
FROM tier t
JOIN futtertrog ft ON ft.gehegeId = t.gehegeId
JOIN futter f ON f.futterId = ft.futterId
JOIN gehege g ON g.gehegeId = t.gehegeId;
</sql><sql name="SQL 2*">drop view v_tierInfo;

CREATE VIEW v_tierInfo AS
SELECT *
FROM tier</sql><sql name="SQL 4*">drop TRIGGER trg_FutterBestellung;

CREATE TRIGGER trg_FutterBestellung
AFTER UPDATE ON futter
FOR EACH ROW
BEGIN
    INSERT INTO log (typ, detail)
    VALUES('bestellung', '10 KG ' || NEW.name || ' wurden zur Bestellung hinzugefügt');
END;

CREATE TRIGGER trg_SchwangerschaftStatus
AFTER UPDATE ON tier
FOR EACH ROW
BEGIN
    -- Wenn das Tier schwanger wird
    INSERT INTO log (typ, detail)
    SELECT 'Schwangerschaft', 'Tier ' || NEW.name || ' wurde schwanger.'
    WHERE NEW.Schwanger = 1 AND OLD.Schwanger = 0;

    -- Wenn das Tier nicht mehr schwanger ist
    INSERT INTO log (typ, detail)
    SELECT 'Schwangerschaft', 'Tier ' || NEW.name || ' ist nicht mehr schwanger.'
    WHERE NEW.Schwanger = 0 AND OLD.Schwanger = 1;
END;



</sql><sql name="SQL 5*">CREATE TABLE bestellung (
    bestellungId INTEGER PRIMARY KEY AUTOINCREMENT,  -- Eindeutige ID für jede Bestellung
    futterId INTEGER,                                -- ID des Futters, das bestellt wird
    mengeKg REAL,                                    -- Menge des Futters in kg
    bestellDatum TEXT DEFAULT (strftime('%Y-%m-%d %H:%M:%S', 'now')),  -- Datum der Bestellung, standardmäßig das aktuelle Datum
    CONSTRAINT fk_futterId FOREIGN KEY (futterId) REFERENCES futter(futterId)  -- Fremdschlüssel zur futter-Tabelle
);

drop table bestellung;

CREATE TABLE log (
	logId INTEGER PRIMARY KEY AUTOINCREMENT,
	typ TEXT,
	detail TEXT,
	datum TEXT DEFAULT (strftime('%Y-%m-%d %H:%M:%S', 'now'))
);
</sql><sql name="SQL 6*">INSERT INTO krankheit VALUES (1, 'Fettleibigkeit', 0, 'Ernaeuhrungsumstellung'), (2,
'Mangelerscheinung', 0, 'Ernaehoehung erhoehen'), (3, 'Verhaltensstoerung', 0, 'Verhalten
analysieren und entsprechende Massnahmen ausfuehren'),
(4, 'Depression', 0,'Mehr Zeit mit dem Tier verbringen'), (5, 'Angststoerung', 0, 'Mit dem Tier
spielen'), (6, 'Arthrose', 0, NULL), (7, 'Dermatitis', 0, NULL), (8, 'Zystitis', 0, NULL), (9,
'Aspergillose', 0, 'Regelmaeßige Gehegereinigung'),
(10, 'Chlamydiose', 1, 'Waermebehandlung'), (11, 'Magen-Darm-Strongyloidiasis', 1, NULL),
(12, 'Salmonellose', 1, 'Isolation mit Fluessigkeitszufuhr und Elektrolyte'), (13, 'Tuberkulose',
1, 'Isolation');

drop Table krankheit;

Create Table krankheit(KrankheitID INTEGER CONSTRAINT pk_KrankheitID PRIMARY KEY, Name TEXT, Ansteckend INTEGER, Behandlungsmassnahme TEXT);</sql><current_tab id="0"/></tab_sql></sqlb_project>
